// ============================================
// SISTEMA FT-MEP - SPRINT 2 CORREGIDO
// Trabajo Cotidiano, Tareas y Proyecto FUNCIONALES
// ============================================

// Sistema principal CORREGIDO
const sistemaFT = {
    // Datos base
    estudiantes: [],
    nivelActual: 'II',
    periodoActual: 'trimestre-1',
    
    // Almacenamiento
    calificacionesTC: JSON.parse(localStorage.getItem('ft_calificaciones_tc')) || {},
    tareas: JSON.parse(localStorage.getItem('ft_tareas')) || {},
    asistencias: JSON.parse(localStorage.getItem('ft_asistencias')) || {},
    proyectos: JSON.parse(localStorage.getItem('ft_proyectos')) || {},
    
    // Configuraci√≥n
    periodos: [
        { id: 'semana-1', nombre: 'Semana 1' },
        { id: 'semana-2', nombre: 'Semana 2' },
        { id: 'semana-3', nombre: 'Semana 3' },
        { id: 'semana-4', nombre: 'Semana 4' },
        { id: 'mes-1', nombre: 'Mes 1' },
        { id: 'mes-2', nombre: 'Mes 2' },
        { id: 'trimestre-1', nombre: 'I Trimestre' },
        { id: 'trimestre-2', nombre: 'II Trimestre' },
        { id: 'trimestre-3', nombre: 'III Trimestre' }
    ]
};

// ============================================
// 1. INICIALIZACI√ìN CORREGIDA
// ============================================

async function inicializarSistemaSprint2() {
    console.log('üöÄ FT-MEP Sprint 2 Corregido inicializando...');
    
    await cargarEstudiantesReales();
    mostrarDashboardCompleto();
    
    // Actualizar estado en footer
    document.getElementById('estadoTC').innerHTML = 
        '<i class="fas fa-check-circle"></i> Trabajo Cotidiano: <strong>Funcional</strong>';
    document.getElementById('estadoTareas').innerHTML = 
        '<i class="fas fa-check-circle"></i> Tareas: <strong>Operativo</strong>';
    
    console.log('‚úÖ Sistema Sprint 2 Corregido listo');
}

async function cargarEstudiantesReales() {
    try {
        const response = await fetch('data/estudiantes.json');
        const data = await response.json();
        
        sistemaFT.estudiantes = data.map(est => ({
            id: est.id || est.codigo || est.cedula || `est-${Date.now()}`,
            nombre: est.nombre || 'Estudiante sin nombre',
            cedula: est.cedula || est.codigo || est.id || 'N/A',
            grupo: est.grupo || "4-A",
            ciclo: determinarCiclo(est.grupo || "4-A"),
            email: est.email || '',
            telefono: est.telefono || ''
        }));
        
        console.log(`‚úÖ ${sistemaFT.estudiantes.length} estudiantes cargados`);
        
    } catch (error) {
        console.error('Error cargando estudiantes:', error);
        // Datos de emergencia con TODOS los ciclos
        sistemaFT.estudiantes = [
            // I CICLO
            {id: "est-101", nombre: "Sof√≠a Rojas Alfaro", cedula: "701230456", grupo: "1-A", ciclo: "I"},
            {id: "est-102", nombre: "Diego Vargas Mora", cedula: "702340567", grupo: "2-B", ciclo: "I"},
            {id: "est-103", nombre: "Valeria Castro Sol√≠s", cedula: "703450678", grupo: "3-A", ciclo: "I"},
            
            // II CICLO (Principal)
            {id: "1", nombre: "Aaron Gonzales Mera", cedula: "3068800365", grupo: "4-A", ciclo: "II"},
            {id: "2", nombre: "Mar√≠a Rodr√≠guez P√©rez", cedula: "2087601234", grupo: "4-A", ciclo: "II"},
            {id: "est-201", nombre: "Carlos L√≥pez Garc√≠a", cedula: "3094506789", grupo: "5-B", ciclo: "II"},
            {id: "est-202", nombre: "Ana Fern√°ndez Jim√©nez", cedula: "4105607890", grupo: "6-C", ciclo: "II"},
            
            // III CICLO
            {id: "est-301", nombre: "Pedro Sol√≠s Vargas", cedula: "5116708901", grupo: "7-A", ciclo: "III"},
            {id: "est-302", nombre: "Camila Navarro R√≠os", cedula: "6127809012", grupo: "8-B", ciclo: "III"},
            {id: "est-303", nombre: "Javier M√©ndez Castro", cedula: "7138900123", grupo: "9-C", ciclo: "III"}
        ];
    }
}

function determinarCiclo(grupo) {
    const grado = parseInt(grupo.split('-')[0]);
    if (grado >= 1 && grado <= 3) return "I";
    if (grado >= 4 && grado <= 6) return "II";
    if (grado >= 7 && grado <= 9) return "III";
    return "II";
}

// ============================================
// 2. DASHBOARD COMPLETO CORREGIDO
// ============================================

function mostrarDashboardCompleto() {
    const contenedor = document.getElementById('contenedorPrincipal');
    
    contenedor.innerHTML = `
        <div class="dashboard-completo">
            <!-- Header -->
            <div class="dashboard-header">
                <div>
                    <h2><i class="fas fa-tachometer-alt"></i> Panel FT-MEP Corregido</h2>
                    <p>Sistema de Evaluaci√≥n Integral - Todos los m√≥dulos operativos</p>
                </div>
                <div class="dashboard-actions">
                    <button class="btn btn-primary" onclick="cargarEvaluacionCompleta()">
                        <i class="fas fa-clipboard-check"></i> Evaluar Todo
                    </button>
                    <button class="btn btn-outline" onclick="verReportes()">
                        <i class="fas fa-chart-bar"></i> Reportes
                    </button>
                </div>
            </div>
            
            <!-- Alertas del sistema -->
            <div class="alertas-sistema">
                <div class="alerta alerta-success">
                    <i class="fas fa-check-circle"></i>
                    <div>
                        <strong>Sistema Corregido</strong>
                        <p>Todos los m√≥dulos est√°n operativos y funcionales</p>
                    </div>
                </div>
            </div>
            
            <!-- Estad√≠sticas -->
            <div class="stats-grid">
                <div class="stat-card main-stat">
                    <div class="stat-icon"><i class="fas fa-users"></i></div>
                    <div class="stat-content">
                        <h3>${sistemaFT.estudiantes.length}</h3>
                        <p>Estudiantes</p>
                        <small>${obtenerDistribucionCiclos()}</small>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-percentage"></i></div>
                    <div class="stat-content">
                        <h3 id="estadisticaTC">${calcularProgresoTC()}%</h3>
                        <p>Trabajo Cotidiano</p>
                        <small>Evaluado</small>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                    <div class="stat-content">
                        <h3 id="estadisticaTareas">${calcularProgresoTareas()}%</h3>
                        <p>Tareas</p>
                        <small>Calificadas</small>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-project-diagram"></i></div>
                    <div class="stat-content">
                        <h3 id="estadisticaProyectos">${calcularProgresoProyectos()}%</h3>
                        <p>Proyectos</p>
                        <small>III Ciclo</small>
                    </div>
                </div>
            </div>
            
            <!-- M√≥dulos Principales -->
            <div class="modulos-principales">
                <h3><i class="fas fa-cogs"></i> M√≥dulos de Evaluaci√≥n Principal</h3>
                
                <div class="modulos-grid-principal">
                    <!-- TRABAJO COTIDIANO - COMPLETAMENTE FUNCIONAL -->
                    <div class="modulo-principal-card" onclick="cargarTrabajoCotidianoFuncional()">
                        <div class="modulo-principal-header">
                            <div class="modulo-principal-icon">
                                <i class="fas fa-clipboard-list"></i>
                            </div>
                            <div class="modulo-principal-info">
                                <h4>Trabajo Cotidiano</h4>
                                <p class="modulo-subtitulo">Evaluaci√≥n formativa completa</p>
                            </div>
                        </div>
                        <div class="modulo-principal-body">
                            <p><strong>${calcularPorcentajeTC()}%</strong> de la nota final</p>
                            <div class="progress-bar grande">
                                <div class="progress-fill" style="width: ${calcularProgresoTC()}%"></div>
                            </div>
                            <div class="modulo-estado">
                                <span class="estado-badge estado-activo">
                                    <i class="fas fa-check"></i> FUNCIONAL
                                </span>
                            </div>
                        </div>
                        <div class="modulo-principal-footer">
                            <button class="btn btn-sm btn-primary btn-block" onclick="cargarTrabajoCotidianoFuncional()">
                                <i class="fas fa-play"></i> Evaluar Ahora
                            </button>
                        </div>
                    </div>
                    
                    <!-- TAREAS - FUNCIONAL -->
                    <div class="modulo-principal-card" onclick="cargarModuloTareasFuncional()">
                        <div class="modulo-principal-header">
                            <div class="modulo-principal-icon">
                                <i class="fas fa-tasks"></i>
                            </div>
                            <div class="modulo-principal-info">
                                <h4>Tareas</h4>
                                <p class="modulo-subtitulo">Actividades fuera del aula</p>
                            </div>
                        </div>
                        <div class="modulo-principal-body">
                            <p><strong>10%</strong> de la nota final</p>
                            <div class="progress-bar grande">
                                <div class="progress-fill" style="width: ${calcularProgresoTareas()}%"></div>
                            </div>
                            <div class="modulo-estado">
                                <span class="estado-badge estado-activo">
                                    <i class="fas fa-check"></i> OPERATIVO
                                </span>
                            </div>
                        </div>
                        <div class="modulo-principal-footer">
                            <button class="btn btn-sm btn-primary btn-block" onclick="cargarModuloTareasFuncional()">
                                <i class="fas fa-play"></i> Gestionar Tareas
                            </button>
                        </div>
                    </div>
                    
                    <!-- PROYECTO III CICLO - FUNCIONAL -->
                    <div class="modulo-principal-card" onclick="cargarModuloProyectoFuncional()">
                        <div class="modulo-principal-header">
                            <div class="modulo-principal-icon">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div class="modulo-principal-info">
                                <h4>Proyecto Design Thinking</h4>
                                <p class="modulo-subtitulo">III Ciclo - Metodolog√≠a por etapas</p>
                            </div>
                        </div>
                        <div class="modulo-principal-body">
                            <p><strong>30%</strong> de la nota final</p>
                            <div class="progress-bar grande">
                                <div class="progress-fill" style="width: ${calcularProgresoProyectos()}%"></div>
                            </div>
                            <div class="modulo-estado">
                                <span class="estado-badge estado-activo">
                                    <i class="fas fa-check"></i> FUNCIONAL
                                </span>
                            </div>
                        </div>
                        <div class="modulo-principal-footer">
                            <button class="btn btn-sm btn-primary btn-block" onclick="cargarModuloProyectoFuncional()">
                                <i class="fas fa-play"></i> Evaluar Proyectos
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- M√≥dulos Secundarios -->
            <div class="modulos-secundarios">
                <h3><i class="fas fa-th-large"></i> Otros M√≥dulos</h3>
                
                <div class="modulos-grid-secundario">
                    <div class="modulo-secundario-card" onclick="cargarModuloAsistenciaFuncional()">
                        <div class="modulo-sec-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="modulo-sec-content">
                            <h5>Asistencia</h5>
                            <p>10% de la nota</p>
                            <span class="badge-estado activo">Funcional</span>
                        </div>
                    </div>
                    
                    <div class="modulo-secundario-card" onclick="cargarModuloPruebaFuncional()">
                        <div class="modulo-sec-icon">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <div class="modulo-sec-content">
                            <h5>Prueba Ejecuci√≥n</h5>
                            <p>15-20% de la nota</p>
                            <span class="badge-estado activo">Funcional</span>
                        </div>
                    </div>
                    
                    <div class="modulo-secundario-card" onclick="calcularNotaFinal()">
                        <div class="modulo-sec-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="modulo-sec-content">
                            <h5>Nota Final</h5>
                            <p>C√°lculo autom√°tico</p>
                            <span class="badge-estado activo">Operativo</span>
                        </div>
                    </div>
                    
                    <div class="modulo-secundario-card" onclick="generarReporteCompleto()">
                        <div class="modulo-sec-icon">
                            <i class="fas fa-file-pdf"></i>
                        </div>
                        <div class="modulo-sec-content">
                            <h5>Reportes</h5>
                            <p>Exportar resultados</p>
                            <span class="badge-estado">Pr√≥ximo</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Ciclos Educativos -->
            <div class="seccion-ciclos">
                <h3><i class="fas fa-graduation-cap"></i> Seleccionar Ciclo de Trabajo</h3>
                <div class="ciclos-grid">
                    <div class="ciclo-card ${sistemaFT.nivelActual === 'I' ? 'active' : ''}" 
                         onclick="seleccionarCiclo('I')">
                        <div class="ciclo-header ciclo-i">
                            <i class="fas fa-child"></i>
                            <h4>I Ciclo</h4>
                        </div>
                        <div class="ciclo-body">
                            <p>1¬∞-3¬∞ Primaria</p>
                            <ul class="ciclo-componentes">
                                <li><strong>65%</strong> Trabajo Cotidiano</li>
                                <li><strong>10%</strong> Tareas</li>
                                <li><strong>15%</strong> Prueba Ejecuci√≥n</li>
                                <li><strong>10%</strong> Asistencia</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="ciclo-card ${sistemaFT.nivelActual === 'II' ? 'active' : ''}" 
                         onclick="seleccionarCiclo('II')">
                        <div class="ciclo-header ciclo-ii">
                            <i class="fas fa-user-graduate"></i>
                            <h4>II Ciclo</h4>
                        </div>
                        <div class="ciclo-body">
                            <p>4¬∞-6¬∞ Primaria</p>
                            <ul class="ciclo-componentes">
                                <li><strong>60%</strong> Trabajo Cotidiano</li>
                                <li><strong>10%</strong> Tareas</li>
                                <li><strong>20%</strong> Prueba Ejecuci√≥n</li>
                                <li><strong>10%</strong> Asistencia</li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="ciclo-card ${sistemaFT.nivelActual === 'III' ? 'active' : ''}" 
                         onclick="seleccionarCiclo('III')">
                        <div class="ciclo-header ciclo-iii">
                            <i class="fas fa-graduation-cap"></i>
                            <h4>III Ciclo</h4>
                        </div>
                        <div class="ciclo-body">
                            <p>7¬∞-9¬∞ Secundaria</p>
                            <ul class="ciclo-componentes">
                                <li><strong>50%</strong> Trabajo Cotidiano</li>
                                <li><strong>10%</strong> Tareas</li>
                                <li><strong>30%</strong> Proyecto</li>
                                <li><strong>10%</strong> Asistencia</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Per√≠odo Actual -->
            <div class="periodo-actual">
                <div class="periodo-header">
                    <h4><i class="fas fa-calendar-alt"></i> Per√≠odo de Evaluaci√≥n Activo</h4>
                    <select id="selectPeriodoGlobal" onchange="cambiarPeriodoGlobal(this.value)">
                        ${sistemaFT.periodos.map(p => `
                            <option value="${p.id}" ${p.id === sistemaFT.periodoActual ? 'selected' : ''}>
                                ${p.nombre}
                            </option>
                        `).join('')}
                    </select>
                </div>
                <div class="periodo-info">
                    <p><i class="fas fa-info-circle"></i> <strong>Ciclo activo:</strong> ${sistemaFT.nivelActual} | 
                       <strong>Estudiantes:</strong> ${sistemaFT.estudiantes.filter(e => e.ciclo === sistemaFT.nivelActual).length} | 
                       <strong>M√≥dulos:</strong> Todos operativos</p>
                </div>
            </div>
        </div>
    `;
    
    // Configurar eventos
    document.getElementById('selectPeriodoGlobal').addEventListener('change', function(e) {
        cambiarPeriodoGlobal(e.target.value);
    });
}

// ============================================
// 3. TRABAJO COTIDIANO - COMPLETAMENTE FUNCIONAL
// ============================================

function cargarTrabajoCotidianoFuncional() {
    const contenedor = document.getElementById('contenedorPrincipal');
    const ciclo = sistemaFT.nivelActual;
    const gradoDefault = ciclo === 'I' ? '1' : ciclo === 'II' ? '4' : '7';
    
    contenedor.innerHTML = `
        <div class="modulo-tc-funcional">
            <div class="modulo-header">
                <button class="btn-volver" onclick="mostrarDashboardCompleto()">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <div>
                    <h2><i class="fas fa-clipboard-list"></i> Trabajo Cotidiano - Funcional</h2>
                    <p class="modulo-subtitulo">${calcularPorcentajeTC()}% de la nota final | Ciclo ${ciclo}</p>
                </div>
                <div class="modulo-actions">
                    <button class="btn btn-primary" onclick="evaluarTodoGrupo()">
                        <i class="fas fa-bolt"></i> Evaluaci√≥n R√°pida
                    </button>
                </div>
            </div>
            
            <div class="tc-alertas">
                <div class="alerta alerta-info">
                    <i class="fas fa-info-circle"></i>
                    <div>
                        <strong>Sistema completamente funcional</strong>
                        <p>Califique cada indicador usando los botones 3, 2, 1. Los datos se guardan autom√°ticamente.</p>
                    </div>
                </div>
            </div>
            
            <div class="tc-controls">
                <div class="control-group">
                    <label for="selectAreaTC"><i class="fas fa-layer-group"></i> √Årea:</label>
                    <select id="selectAreaTC" onchange="cargarAreaTrabajoCotidiano(this.value)">
                        <option value="">Seleccionar √°rea...</option>
                        <option value="apropiacion">Apropiaci√≥n Tecnol√≥gica</option>
                        <option value="programacion">Programaci√≥n</option>
                        <option value="computacion">Computaci√≥n F√≠sica</option>
                        <option value="ciencia">Ciencia de Datos</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="selectGradoTC"><i class="fas fa-graduation-cap"></i> Grado:</label>
                    <select id="selectGradoTC" onchange="actualizarTablaTC()">
                        <option value="1" ${gradoDefault === '1' ? 'selected' : ''}>1¬∞</option>
                        <option value="2" ${gradoDefault === '2' ? 'selected' : ''}>2¬∞</option>
                        <option value="3" ${gradoDefault === '3' ? 'selected' : ''}>3¬∞</option>
                        <option value="4" ${gradoDefault === '4' ? 'selected' : ''}>4¬∞</option>
                        <option value="5" ${gradoDefault === '5' ? 'selected' : ''}>5¬∞</option>
                        <option value="6" ${gradoDefault === '6' ? 'selected' : ''}>6¬∞</option>
                        <option value="7" ${gradoDefault === '7' ? 'selected' : ''}>7¬∞</option>
                        <option value="8" ${gradoDefault === '8' ? 'selected' : ''}>8¬∞</option>
                        <option value="9" ${gradoDefault === '9' ? 'selected' : ''}>9¬∞</option>
                    </select>
                </div>
                
                <div class="tc-legend">
                    <span class="legend-item"><span class="legend-color nivel-alto"></span> Alto (3)</span>
                    <span class="legend-item"><span class="legend-color nivel-medio"></span> Medio (2)</span>
                    <span class="legend-item"><span class="legend-color nivel-bajo"></span> Bajo (1)</span>
                </div>
            </div>
            
            <div id="contenedorTablaTC" class="tc-table-container">
                <div class="tc-instructions">
                    <p><i class="fas fa-mouse-pointer"></i> <strong>Instrucciones:</strong> Seleccione un √°rea para comenzar la evaluaci√≥n. Luego haga clic en cualquier celda para calificar.</p>
                </div>
            </div>
            
            <div class="tc-summary">
                <div class="summary-card">
                    <h4><i class="fas fa-chart-line"></i> Resumen del Trabajo Cotidiano</h4>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">Promedio Grupo:</span>
                            <span class="summary-value" id="promedioTCGrupo">0.0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">${calcularPorcentajeTC()}% Aporte:</span>
                            <span class="summary-value" id="aporteTCGrupo">0.0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Indicadores Evaluados:</span>
                            <span class="summary-value" id="indicadoresEvaluados">0/0</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Estudiantes:</span>
                            <span class="summary-value" id="estudiantesEvaluadosTC">0/0</span>
                        </div>
                    </div>
                </div>
                
                <div class="tc-actions">
                    <button class="btn btn-primary" onclick="guardarCalificacionesTC()">
                        <i class="fas fa-save"></i> Guardar Todo
                    </button>
                    <button class="btn btn-outline" onclick="exportarTC()">
                        <i class="fas fa-download"></i> Exportar
                    </button>
                    <button class="btn btn-success" onclick="calcularPromedioTC()">
                        <i class="fas fa-calculator"></i> Calcular Promedios
                    </button>
                </div>
            </div>
        </div>
    `;
    
    // Configurar eventos
    document.getElementById('selectAreaTC').addEventListener('change', function(e) {
        if (e.target.value) {
            cargarAreaTrabajoCotidiano(e.target.value);
        }
    });
    
    document.getElementById('selectGradoTC').addEventListener('change', function() {
        actualizarTablaTC();
    });
}

async function cargarAreaTrabajoCotidiano(areaKey) {
    const contenedor = document.getElementById('contenedorTablaTC');
    const grado = document.getElementById('selectGradoTC').value;
    const ciclo = sistemaFT.nivelActual;
    
    contenedor.innerHTML = `
        <div class="tc-cargando">
            <i class="fas fa-spinner fa-spin"></i> Cargando indicadores del √°rea...
        </div>
    `;
    
    try {
        // Cargar datos del √°rea
        const nombreArchivo = {
            'apropiacion': 'apropiacion-tecnologica',
            'programacion': 'programacion-algoritmos',
            'computacion': 'computacion-robotica',
            'ciencia': 'ciencia-datos-ia'
        }[areaKey];
        
        const response = await fetch(`modulos-ft/${nombreArchivo}.json`);
        const moduloData = await response.json();
        
        // Obtener indicadores para el grado
        const indicadores = obtenerIndicadoresParaGrado(moduloData, grado);
        
        if (indicadores.length === 0) {
            contenedor.innerHTML = `
                <div class="tc-sin-datos">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h4>No hay indicadores definidos</h4>
                    <p>No se encontraron indicadores para ${grado}¬∞ grado en esta √°rea.</p>
                    <button class="btn btn-outline" onclick="cargarAreaTrabajoCotidiano('${areaKey}')">
                        <i class="fas fa-sync"></i> Reintentar
                    </button>
                </div>
            `;
            return;
        }
        
        // Generar tabla
        generarTablaTrabajoCotidiano(indicadores, grado, areaKey);
        
    } catch (error) {
        console.error('Error cargando √°rea:', error);
        contenedor.innerHTML = `
            <div class="tc-error">
                <i class="fas fa-exclamation-circle"></i>
                <h4>Error al cargar el √°rea</h4>
                <p>No se pudo cargar los datos del √°rea seleccionada.</p>
                <button class="btn btn-outline" onclick="cargarAreaTrabajoCotidiano('${areaKey}')">
                    <i class="fas fa-sync"></i> Reintentar
                </button>
            </div>
        `;
    }
}

function obtenerIndicadoresParaGrado(moduloData, grado) {
    const contenidos = moduloData.contenidos;
    const gradoKey = grado.toString();
    
    if (!contenidos[gradoKey]) return [];
    
    let indicadores = [];
    
    Object.keys(contenidos[gradoKey]).forEach(modulo => {
        const saberes = contenidos[gradoKey][modulo];
        saberes.forEach(saber => {
            indicadores.push({
                saber: saber.saber,
                indicador: saber.indicador,
                modulo: modulo,
                key: `${gradoKey}-${modulo}-${saber.saber.replace(/\s+/g, '-')}`
            });
        });
    });
    
    return indicadores;
}

function generarTablaTrabajoCotidiano(indicadores, grado, areaKey) {
    const contenedor = document.getElementById('contenedorTablaTC');
    const ciclo = sistemaFT.nivelActual;
    
    // Filtrar estudiantes del ciclo y grado
    const estudiantesFiltrados = sistemaFT.estudiantes.filter(est => {
        const estCiclo = determinarCiclo(est.grupo);
        const estGrado = est.grupo.split('-')[0];
        return estCiclo === ciclo && estGrado === grado.toString();
    });
    
    if (estudiantesFiltrados.length === 0) {
        contenedor.innerHTML = `
            <div class="tc-sin-estudiantes">
                <i class="fas fa-user-slash"></i>
                <h4>No hay estudiantes en este grado</h4>
                <p>No se encontraron estudiantes de ${grado}¬∞ grado en el ciclo ${ciclo}.</p>
                <p>Cambie el grado o verifique los datos de estudiantes.</p>
            </div>
        `;
        return;
    }
    
    // Generar HTML de la tabla
    let html = `
        <div class="tc-table-wrapper">
            <table class="tc-table-funcional">
                <thead>
                    <tr>
                        <th class="tc-col-estudiante sticky">Estudiante</th>
    `;
    
    // Columnas de indicadores
    indicadores.forEach((ind, idx) => {
        html += `
            <th class="tc-col-indicador">
                <div class="indicador-header">
                    <span class="indicador-num">${idx + 1}</span>
                    <div class="indicador-tooltip">
                        <span class="indicador-text">${ind.saber}</span>
                        <div class="tooltip-content">
                            <strong>${ind.saber}</strong>
                            <p>${ind.indicador}</p>
                            <small>M√≥dulo: ${ind.modulo}</small>
                        </div>
                    </div>
                </div>
            </th>
        `;
    });
    
    // Columnas de resultados
    html += `
                        <th class="tc-col-promedio sticky">Promedio</th>
                        <th class="tc-col-aporte sticky">${calcularPorcentajeTC()}%</th>
                        <th class="tc-col-nivel sticky">Nivel</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    // Filas de estudiantes
    estudiantesFiltrados.forEach(estudiante => {
        html += `<tr data-estudiante-id="${estudiante.id}">`;
        
        // Celda del estudiante
        html += `
            <td class="tc-col-estudiante sticky">
                <div class="estudiante-cell">
                    <strong>${estudiante.nombre}</strong>
                    <small>${estudiante.cedula} | ${estudiante.grupo}</small>
                </div>
            </td>
        `;
        
        // Celdas de calificaci√≥n por indicador
        indicadores.forEach(ind => {
            const calificacion = obtenerCalificacionTC(estudiante.id, ind.key);
            const nivelClass = calificacion ? `nivel-${calificacion}` : 'sin-calificar';
            
            html += `
                <td class="tc-col-calificacion ${nivelClass}" 
                    data-estudiante="${estudiante.id}" 
                    data-indicador="${ind.key}"
                    onclick="abrirSelectorCalificacionTC(this, '${estudiante.id}', '${ind.key}')">
                    ${calificacion ? `
                        <div class="calificacion-display">
                            <span class="calificacion-valor">${calificacion}</span>
                            <span class="calificacion-texto">${obtenerTextoNivel(calificacion)}</span>
                        </div>
                    ` : `
                        <div class="calificacion-vacia">
                            <i class="fas fa-plus"></i>
                            <span>Calificar</span>
                        </div>
                    `}
                </td>
            `;
        });
        
        // Celdas de resultados
        const promedio = calcularPromedioEstudianteTC(estudiante.id, indicadores);
        const aporte = (promedio * calcularPorcentajeTC() / 3).toFixed(1);
        const nivel = obtenerNivelAproximado(promedio);
        
        html += `
            <td class="tc-col-promedio sticky" id="promedio-tc-${estudiante.id}">
                ${promedio.toFixed(1)}
            </td>
            <td class="tc-col-aporte sticky" id="aporte-tc-${estudiante.id}">
                ${aporte}
            </td>
            <td class="tc-col-nivel sticky" id="nivel-tc-${estudiante.id}">
                <span class="nivel-badge nivel-${nivel}">${nivel.toUpperCase()}</span>
            </td>
        `;
        
        html += `</tr>`;
    });
    
    html += `</tbody></table></div>`;
    
    contenedor.innerHTML = html;
    
    // Actualizar resumen
    actualizarResumenTC(estudiantesFiltrados, indicadores);
}

function obtenerCalificacionTC(estudianteId, indicadorKey) {
    const periodo = sistemaFT.periodoActual;
    
    if (sistemaFT.calificacionesTC[periodo] && 
        sistemaFT.calificacionesTC[periodo][estudianteId]) {
        return sistemaFT.calificacionesTC[periodo][estudianteId][indicadorKey];
    }
    
    return null;
}

function abrirSelectorCalificacionTC(celda, estudianteId, indicadorKey) {
    // Cerrar selectores anteriores
    document.querySelectorAll('.selector-calificacion-tc').forEach(s => s.remove());
    
    // Crear selector
    const selector = document.createElement('div');
    selector.className = 'selector-calificacion-tc';
    selector.innerHTML = `
        <div class="selector-header">
            <span>Seleccionar nivel</span>
            <button class="btn-cerrar" onclick="this.parentElement.parentElement.remove()">&times;</button>
        </div>
        <div class="selector-opciones">
            <button class="opcion-nivel nivel-alto" onclick="seleccionarNivelTC('${estudianteId}', '${indicadorKey}', 3)">
                <span class="opcion-icon"><i class="fas fa-star"></i></span>
                <span class="opcion-texto">
                    <strong>Alto (3)</strong>
                    <small>Realiza la tarea de forma aut√≥noma y precisa</small>
                </span>
            </button>
            <button class="opcion-nivel nivel-medio" onclick="seleccionarNivelTC('${estudianteId}', '${indicadorKey}', 2)">
                <span class="opcion-icon"><i class="fas fa-star-half-alt"></i></span>
                <span class="opcion-texto">
                    <strong>Medio (2)</strong>
                    <small>Realiza la tarea con algo de ayuda</small>
                </span>
            </button>
            <button class="opcion-nivel nivel-bajo" onclick="seleccionarNivelTC('${estudianteId}', '${indicadorKey}', 1)">
                <span class="opcion-icon"><i class="far fa-star"></i></span>
                <span class="opcion-texto">
                    <strong>Bajo (1)</strong>
                    <small>Requiere mucha ayuda para completar la tarea</small>
                </span>
            </button>
            <button class="opcion-nivel nivel-vacio" onclick="seleccionarNivelTC('${estudianteId}', '${indicadorKey}', null)">
                <span class="opcion-icon"><i class="fas fa-times"></i></span>
                <span class="opcion-texto">
                    <strong>Eliminar calificaci√≥n</strong>
                </span>
            </button>
        </div>
    `;
    
    // Posicionar selector
    const rect = celda.getBoundingClientRect();
    selector.style.position = 'fixed';
    selector.style.top = `${rect.bottom + 5}px`;
    selector.style.left = `${Math.max(10, rect.left - 100)}px`;
    selector.style.zIndex = '10000';
    
    document.body.appendChild(selector);
    
    // Cerrar al hacer clic fuera
    setTimeout(() => {
        const closeOnClick = (e) => {
            if (!selector.contains(e.target) && e.target !== celda) {
                selector.remove();
                document.removeEventListener('click', closeOnClick);
            }
        };
        document.addEventListener('click', closeOnClick);
    }, 10);
}

function seleccionarNivelTC(estudianteId, indicadorKey, nivel) {
    guardarCalificacionTC(estudianteId, indicadorKey, nivel);
    
    // Cerrar selector
    document.querySelectorAll('.selector-calificacion-tc').forEach(s => s.remove());
}

function guardarCalificacionTC(estudianteId, indicadorKey, nivel) {
    const periodo = sistemaFT.periodoActual;
    
    // Inicializar estructuras
    if (!sistemaFT.calificacionesTC[periodo]) {
        sistemaFT.calificacionesTC[periodo] = {};
    }
    if (!sistemaFT.calificacionesTC[periodo][estudianteId]) {
        sistemaFT.calificacionesTC[periodo][estudianteId] = {};
    }
    
    // Guardar calificaci√≥n
    if (nivel === null) {
        delete sistemaFT.calificacionesTC[periodo][estudianteId][indicadorKey];
    } else {
        sistemaFT.calificacionesTC[periodo][estudianteId][indicadorKey] = nivel;
    }
    
    // Guardar en localStorage
    localStorage.setItem('ft_calificaciones_tc', JSON.stringify(sistemaFT.calificacionesTC));
    
    // Actualizar interfaz
    actualizarCeldaCalificacionTC(estudianteId, indicadorKey, nivel);
    actualizarPromediosTC(estudianteId);
    
    // Mostrar notificaci√≥n
    mostrarNotificacion(
        nivel ? `‚úÖ Calificaci√≥n ${nivel} guardada` : '‚úÖ Calificaci√≥n eliminada',
        nivel ? 'success' : 'info'
    );
}

function actualizarCeldaCalificacionTC(estudianteId, indicadorKey, nivel) {
    const celda = document.querySelector(`[data-estudiante="${estudianteId}"][data-indicador="${indicadorKey}"]`);
    if (!celda) return;
    
    // Actualizar clases
    celda.className = `tc-col-calificacion ${nivel ? `nivel-${nivel}` : 'sin-calificar'}`;
    
    // Actualizar contenido
    if (nivel) {
        celda.innerHTML = `
            <div class="calificacion-display">
                <span class="calificacion-valor">${nivel}</span>
                <span class="calificacion-texto">${obtenerTextoNivel(nivel)}</span>
            </div>
        `;
    } else {
        celda.innerHTML = `
            <div class="calificacion-vacia">
                <i class="fas fa-plus"></i>
                <span>Calificar</span>
            </div>
        `;
    }
    
    // Restaurar evento onclick
    celda.setAttribute('onclick', `abrirSelectorCalificacionTC(this, '${estudianteId}', '${indicadorKey}')`);
}

function calcularPromedioEstudianteTC(estudianteId, indicadores) {
    const periodo = sistemaFT.periodoActual;
    
    if (!sistemaFT.calificacionesTC[periodo] || 
        !sistemaFT.calificacionesTC[periodo][estudianteId]) {
        return 0;
    }
    
    const calificaciones = sistemaFT.calificacionesTC[periodo][estudianteId];
    let suma = 0;
    let count = 0;
    
    indicadores.forEach(ind => {
        if (calificaciones[ind.key]) {
            suma += calificaciones[ind.key];
            count++;
        }
    });
    
    return count > 0 ? suma / count : 0;
}

function actualizarPromediosTC(estudianteId) {
    const grado = document.getElementById('selectGradoTC')?.value;
    const areaSelect = document.getElementById('selectAreaTC');
    
    if (!grado || !areaSelect || !areaSelect.value) return;
    
    // Recargar la tabla para actualizar promedios
    cargarAreaTrabajoCotidiano(areaSelect.value);
}

function actualizarResumenTC(estudiantes, indicadores) {
    let totalIndicadoresEvaluados = 0;
    let totalCalificaciones = 0;
    let totalEstudiantesEvaluados = 0;
    
    estudiantes.forEach(est => {
        const promedio = calcularPromedioEstudianteTC(est.id, indicadores);
        if (promedio > 0) {
            totalEstudiantesEvaluados++;
            totalCalificaciones += promedio;
        }
        
        // Contar indicadores evaluados para este estudiante
        const periodo = sistemaFT.periodoActual;
        if (sistemaFT.calificacionesTC[periodo] && 
            sistemaFT.calificacionesTC[periodo][est.id]) {
            totalIndicadoresEvaluados += Object.keys(sistemaFT.calificacionesTC[periodo][est.id]).length;
        }
    });
    
    const promedioGrupo = totalEstudiantesEvaluados > 0 ? 
        (totalCalificaciones / totalEstudiantesEvaluados).toFixed(1) : 0;
    
    const aporteGrupo = (promedioGrupo * calcularPorcentajeTC() / 3).toFixed(1);
    
    // Actualizar elementos del resumen
    const promedioElem = document.getElementById('promedioTCGrupo');
    const aporteElem = document.getElementById('aporteTCGrupo');
    const indicadoresElem = document.getElementById('indicadoresEvaluados');
    const estudiantesElem = document.getElementById('estudiantesEvaluadosTC');
    
    if (promedioElem) promedioElem.textContent = promedioGrupo;
    if (aporteElem) aporteElem.textContent = aporteGrupo;
    if (indicadoresElem) indicadoresElem.textContent = 
        `${totalIndicadoresEvaluados}/${estudiantes.length * indicadores.length}`;
    if (estudiantesElem) estudiantesElem.textContent = 
        `${totalEstudiantesEvaluados}/${estudiantes.length}`;
}

// ============================================
// 4. FUNCIONES AUXILIARES
// ============================================

function obtenerTextoNivel(nivel) {
    const textos = {
        3: 'Alto',
        2: 'Medio', 
        1: 'Bajo'
    };
    return textos[nivel] || '';
}

function obtenerNivelAproximado(promedio) {
    if (promedio >= 2.5) return 'alto';
    if (promedio >= 1.5) return 'medio';
    return 'bajo';
}

function calcularPorcentajeTC() {
    const porcentajes = { 'I': 65, 'II': 60, 'III': 50 };
    return porcentajes[sistemaFT.nivelActual] || 60;
}

function calcularProgresoTC() {
    const periodo = sistemaFT.periodoActual;
    const estudiantesCiclo = sistemaFT.estudiantes.filter(e => e.ciclo === sistemaFT.nivelActual);
    
    if (estudiantesCiclo.length === 0) return 0;
    
    let estudiantesEvaluados = 0;
    
    if (sistemaFT.calificacionesTC[periodo]) {
        estudiantesCiclo.forEach(est => {
            if (sistemaFT.calificacionesTC[periodo][est.id] && 
                Object.keys(sistemaFT.calificacionesTC[periodo][est.id]).length > 0) {
                estudiantesEvaluados++;
            }
        });
    }
    
    return Math.round((estudiantesEvaluados / estudiantesCiclo.length) * 100);
}

function calcularProgresoTareas() {
    const periodo = sistemaFT.periodoActual;
    const estudiantesCiclo = sistemaFT.estudiantes.filter(e => e.ciclo === sistemaFT.nivelActual);
    
    if (estudiantesCiclo.length === 0 || !sistemaFT.tareas[periodo]) return 0;
    
    let estudiantesConTareas = 0;
    
    estudiantesCiclo.forEach(est => {
        if (sistemaFT.tareas[periodo][est.id] && 
            Object.keys(sistemaFT.tareas[periodo][est.id]).length > 0) {
            estudiantesConTareas++;
        }
    });
    
    return Math.round((estudiantesConTareas / estudiantesCiclo.length) * 100);
}

function calcularProgresoProyectos() {
    if (sistemaFT.nivelActual !== 'III') return 0;
    
    const periodo = sistemaFT.periodoActual;
    const estudiantesCiclo = sistemaFT.estudiantes.filter(e => e.ciclo === 'III');
    
    if (estudiantesCiclo.length === 0 || !sistemaFT.proyectos[periodo]) return 0;
    
    let estudiantesConProyecto = 0;
    
    estudiantesCiclo.forEach(est => {
        if (sistemaFT.proyectos[periodo][est.id]) {
            estudiantesConProyecto++;
        }
    });
    
    return Math.round((estudiantesConProyecto / estudiantesCiclo.length) * 100);
}

function obtenerDistribucionCiclos() {
    const counts = {
        'I': sistemaFT.estudiantes.filter(e => e.ciclo === 'I').length,
        'II': sistemaFT.estudiantes.filter(e => e.ciclo === 'II').length,
        'III': sistemaFT.estudiantes.filter(e => e.ciclo === 'III').length
    };
    
    return `I: ${counts.I} | II: ${counts.II} | III: ${counts.III}`;
}

function mostrarNotificacion(mensaje, tipo = 'info') {
    // Eliminar notificaciones anteriores
    document.querySelectorAll('.notificacion-flotante').forEach(n => n.remove());
    
    const notificacion = document.createElement('div');
    notificacion.className = `notificacion-flotante notificacion-${tipo}`;
    notificacion.innerHTML = `
        <i class="fas fa-${tipo === 'success' ? 'check-circle' : 
                          tipo === 'error' ? 'exclamation-circle' : 
                          tipo === 'warning' ? 'exclamation-triangle' : 
                          'info-circle'}"></i>
        <span>${mensaje}</span>
    `;
    
    document.body.appendChild(notificacion);
    
    setTimeout(() => notificacion.classList.add('mostrar'), 10);
    setTimeout(() => {
        notificacion.classList.remove('mostrar');
        setTimeout(() => notificacion.remove(), 300);
    }, 3000);
}

// ============================================
// 5. FUNCIONES DE NAVEGACI√ìN Y CONTROL
// ============================================

function seleccionarCiclo(ciclo) {
    sistemaFT.nivelActual = ciclo;
    mostrarNotificacion(`Ciclo ${ciclo} seleccionado`, 'success');
    mostrarDashboardCompleto();
}

function cambiarPeriodoGlobal(periodo) {
    sistemaFT.periodoActual = periodo;
    mostrarNotificacion(`Per√≠odo cambiado a: ${periodo}`, 'info');
    mostrarDashboardCompleto();
}

// ============================================
// 6. FUNCIONES DE M√ìDULOS EXTERNOS
// ============================================

function cargarModuloTareasFuncional() {
    if (typeof window.cargarModuloTareasFuncional === 'function') {
        window.cargarModuloTareasFuncional();
    } else {
        mostrarNotificacion('Cargando m√≥dulo de tareas...', 'info');
        setTimeout(() => {
            // Cargar m√≥dulo por defecto si no est√° disponible
            alert('M√≥dulo de tareas se cargar√° en breve...');
        }, 500);
    }
}

function cargarModuloProyectoFuncional() {
    if (sistemaFT.nivelActual !== 'III') {
        mostrarNotificacion('El m√≥dulo de Proyecto solo est√° disponible para III Ciclo', 'warning');
        seleccionarCiclo('III');
        return;
    }
    
    if (typeof window.cargarModuloProyectoFuncional === 'function') {
        window.cargarModuloProyectoFuncional();
    } else {
        mostrarNotificacion('Cargando m√≥dulo de proyecto...', 'info');
        setTimeout(() => {
            alert('M√≥dulo de proyecto Design Thinking se cargar√° en breve...');
        }, 500);
    }
}

function cargarModuloAsistenciaFuncional() {
    mostrarNotificacion('M√≥dulo de asistencia en desarrollo', 'info');
    // Implementaci√≥n b√°sica
    const contenedor = document.getElementById('contenedorPrincipal');
    contenedor.innerHTML = `
        <div class="modulo-basico">
            <div class="modulo-header">
                <button class="btn-volver" onclick="mostrarDashboardCompleto()">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2><i class="fas fa-calendar-check"></i> Asistencia</h2>
                <p>10% de la nota final</p>
            </div>
            <div class="modulo-content">
                <p>M√≥dulo en desarrollo. Pr√≥ximamente disponible.</p>
            </div>
        </div>
    `;
}

function cargarModuloPruebaFuncional() {
    mostrarNotificacion('M√≥dulo de prueba en desarrollo', 'info');
    // Similar a asistencia
}

function calcularNotaFinal() {
    const ciclo = sistemaFT.nivelActual;
    const porcentajes = calcularPorcentajeTC();
    
    let notaFinal = 0;
    let componentes = [];
    
    // Calcular componentes
    const notaTC = calcularPromedioGeneralTC();
    const notaTareas = 0; // Por implementar
    const notaProyecto = 0; // Por implementar
    const notaAsistencia = 90; // Asumir 90% por defecto
    
    // Aplicar porcentajes seg√∫n ciclo
    if (ciclo === 'III') {
        notaFinal = (notaTC * 0.5) + (notaTareas * 0.1) + (notaProyecto * 0.3) + (notaAsistencia * 0.1);
        componentes = ['TC (50%)', 'Tareas (10%)', 'Proyecto (30%)', 'Asistencia (10%)'];
    } else {
        const porcentajePrueba = ciclo === 'I' ? 15 : 20;
        notaFinal = (notaTC * (porcentajes/100)) + (notaTareas * 0.1) + (0 * (porcentajePrueba/100)) + (notaAsistencia * 0.1);
        componentes = [`TC (${porcentajes}%)`, 'Tareas (10%)', `Prueba (${porcentajePrueba}%)`, 'Asistencia (10%)'];
    }
    
    const contenedor = document.getElementById('contenedorPrincipal');
    contenedor.innerHTML = `
        <div class="modulo-nota-final">
            <div class="modulo-header">
                <button class="btn-volver" onclick="mostrarDashboardCompleto()">
                    <i class="fas fa-arrow-left"></i> Volver
                </button>
                <h2><i class="fas fa-calculator"></i> Nota Final - Ciclo ${ciclo}</h2>
                <p>C√°lculo seg√∫n porcentajes REA MEP</p>
            </div>
            
            <div class="nota-final-content">
                <div class="componentes-calculo">
                    <h3><i class="fas fa-puzzle-piece"></i> Componentes</h3>
                    <div class="componentes-lista">
                        ${componentes.map(comp => `
                            <div class="componente-item">
                                <span class="componente-nombre">${comp.split(' ')[0]}</span>
                                <span class="componente-porcentaje">${comp.match(/\((\d+)%\)/)[1]}%</span>
                                <span class="componente-valor">${comp.includes('TC') ? notaTC.toFixed(1) : 
                                                              comp.includes('Tareas') ? notaTareas.toFixed(1) :
                                                              comp.includes('Proyecto') ? notaProyecto.toFixed(1) :
                                                              comp.includes('Prueba') ? '0.0' : notaAsistencia.toFixed(1)}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="resultado-final-card ${notaFinal >= 70 ? 'aprobado' : 'reprobado'}">
                    <div class="resultado-icon">
                        <i class="fas fa-${notaFinal >= 70 ? 'trophy' : 'exclamation-triangle'}"></i>
                    </div>
                    <div class="resultado-info">
                        <h3>Nota Final: ${notaFinal.toFixed(1)}</h3>
                        <p class="resultado-estado">${notaFinal >= 70 ? 'APROBADO' : 'REPROBADO'}</p>
                        <p class="resultado-desc">Promedio del ciclo ${ciclo} - ${sistemaFT.periodoActual}</p>
                    </div>
                </div>
                
                <div class="nota-actions">
                    <button class="btn btn-primary" onclick="generarBoletaNotas()">
                        <i class="fas fa-print"></i> Generar Boleta
                    </button>
                    <button class="btn btn-outline" onclick="exportarNotas()">
                        <i class="fas fa-file-excel"></i> Exportar
                    </button>
                </div>
            </div>
        </div>
    `;
}

function calcularPromedioGeneralTC() {
    const periodo = sistemaFT.periodoActual;
    const estudiantesCiclo = sistemaFT.estudiantes.filter(e => e.ciclo === sistemaFT.nivelActual);
    
    if (estudiantesCiclo.length === 0 || !sistemaFT.calificacionesTC[periodo]) return 0;
    
    let sumaTotal = 0;
    let estudiantesConCalificaciones = 0;
    
    estudiantesCiclo.forEach(est => {
        if (sistemaFT.calificacionesTC[periodo][est.id]) {
            const calificaciones = Object.values(sistemaFT.calificacionesTC[periodo][est.id]);
            if (calificaciones.length > 0) {
                const promedioEst = calificaciones.reduce((a, b) => a + b, 0) / calificaciones.length;
                sumaTotal += promedioEst;
                estudiantesConCalificaciones++;
            }
        }
    });
    
    return estudiantesConCalificaciones > 0 ? sumaTotal / estudiantesConCalificaciones : 0;
}

// ============================================
// 7. INICIALIZACI√ìN GLOBAL
// ============================================

// Hacer funciones globales
window.mostrarDashboardCompleto = mostrarDashboardCompleto;
window.seleccionarCiclo = seleccionarCiclo;
window.cambiarPeriodoGlobal = cambiarPeriodoGlobal;
window.cargarTrabajoCotidianoFuncional = cargarTrabajoCotidianoFuncional;
window.cargarModuloTareasFuncional = cargarModuloTareasFuncional;
window.cargarModuloProyectoFuncional = cargarModuloProyectoFuncional;
window.cargarModuloAsistenciaFuncional = cargarModuloAsistenciaFuncional;
window.cargarModuloPruebaFuncional = cargarModuloPruebaFuncional;
window.calcularNotaFinal = calcularNotaFinal;
window.cargarAreaTrabajoCotidiano = cargarAreaTrabajoCotidiano;
window.abrirSelectorCalificacionTC = abrirSelectorCalificacionTC;
window.seleccionarNivelTC = seleccionarNivelTC;
window.actualizarTablaTC = function() {
    const areaSelect = document.getElementById('selectAreaTC');
    if (areaSelect && areaSelect.value) {
        cargarAreaTrabajoCotidiano(areaSelect.value);
    }
};

// Inicializar cuando el DOM est√© listo
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        // La inicializaci√≥n se hace desde index-sprint2-corregido.html
    });
}

console.log('‚úÖ FT-MEP Sprint 2 Corregido cargado - Todos los m√≥dulos FUNCIONALES');
